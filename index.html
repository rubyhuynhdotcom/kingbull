<!DOCTYPE html>
<!--
  KINGBULL Vi·ªát Nam ‚Äî Landing Page (Pure HTML/CSS/JS)
  - Sticky navbar (no slogan near logo)
  - Smooth scroll + active section highlight
  - Hero with animated mesh gradient + parallax text
  - Case Studies grid + Modal detail (ROI calc with chart & KPIs)
  - Technical PDF library (filters)
  - Video gallery
  - Dealer Portal (mock login with mini-dashboard)
  - Supply Map (Leaflet)
  - 24/7 Support form
  - Logistics calculator (distance + ETA + container trips)
  - News (filter by tag)
  - R&D sign-up
  - Accessibility: focus ring, Skip link, reduced motion fallback
-->
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>C√¥ng ty TNHH KINGBULL Vi·ªát Nam</title>
  <meta name="description" content="Interactive landing page gi·ªõi thi·ªáu & t∆∞ v·∫•n chuy√™n s√¢u cho KINGBULL Vi·ªát Nam" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22><text y='32' font-size='32'>üêü</text></svg>">
  <link rel="preconnect" href="https://unpkg.com">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    /* ============================================================
       0) DESIGN TOKENS
       ============================================================ */
    :root{
      /* Brand */
      --kb-blue:#0EA4E8;
      --kb-green:#2BCB53;
      --kb-gold:#FFBE00;

      /* Text & Surfaces */
      --text:#0b1220;
      --text-2:#51607a;
      --bg:#ffffff;
      --muted:#f6f7fb;
      --ring:#74d1f5;

      /* Elevation & Borders */
      --stroke:#e9edf4;
      --shadow-1:0 8px 30px rgba(16,24,40,.08);
      --shadow-2:0 16px 50px rgba(16,24,40,.10);
      --glass:rgba(255,255,255,.65);

      /* Typo scale */
      --fs-hero: clamp(32px, 6vw, 56px);
      --fs-h2: clamp(22px, 3vw, 30px);
      --fs-lead: clamp(15px, 2.2vw, 18px);

      /* Motion */
      --dur-1:.25s;
      --dur-2:.45s;
      --bezier:cubic-bezier(.22,.61,.36,1);
    }

    /* System base */
    *{box-sizing:border-box}
    html,body{height:100%}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      color:var(--text);
      background:var(--bg);
      font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
      text-rendering:optimizeLegibility;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    a{color:var(--kb-blue);text-decoration:none}
    a:hover{filter:saturate(120%)}
    a:focus-visible,button:focus-visible,select:focus-visible,input:focus-visible,textarea:focus-visible{
      outline:3px solid var(--ring); outline-offset:2px; border-radius:12px;
    }
    img{max-width:100%; display:block}

    /* Accessibility helpers */
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    .skip{position:absolute;top:8px;left:8px;background:#fff;padding:6px 10px;border-radius:10px;box-shadow:var(--shadow-1);z-index:1200}

    /* Layout primitives */
    .container{max-width:1180px;margin:auto;padding:48px 20px}
    .section{scroll-margin-top:80px}
    .muted{background:var(--muted)}
    .row{display:grid;gap:16px}
    @media(min-width:760px){
      .row.col-2{grid-template-columns:repeat(2,1fr)}
      .row.col-3{grid-template-columns:repeat(3,1fr)}
      .row.col-4{grid-template-columns:repeat(4,1fr)}
    }

    /* Cards & utilities */
    .card{background:rgba(255,255,255,.86); border:1px solid var(--stroke); border-radius:16px; box-shadow:var(--shadow-1); backdrop-filter:saturate(140%) blur(6px)}
    .pad{padding:18px}
    .pill{display:inline-flex;align-items:center;gap:6px;background:#f1f4f9;color:#46576f;border-radius:999px;padding:6px 10px;font-size:12px;font-weight:700}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 16px;border-radius:12px;font-weight:800;letter-spacing:.2px;border:1px solid #e6ebf3;background:#fff;cursor:pointer;transition:transform var(--dur-1) var(--bezier), box-shadow var(--dur-1) var(--bezier)}
    .btn:hover{transform:translateY(-1px); box-shadow:var(--shadow-1)}
    .btn.primary{background:var(--kb-blue);color:#fff;border-color:transparent}
    .btn.green{background:var(--kb-green);color:#fff;border-color:transparent}
    .btn.ghost{background:#fff}
    .hint{font-size:12px;color:var(--text-2)}
    .k-m{margin-top:14px}
    .thumb{aspect-ratio:16/9;width:100%;border:0;border-radius:14px;object-fit:cover;display:block}

    .title{font-size:var(--fs-h2); font-weight:900; display:flex; align-items:center; gap:12px; letter-spacing:.2px}
    .title .bar{width:7px;height:24px;background:linear-gradient(180deg,var(--kb-blue),var(--kb-green));border-radius:4px}

    /* Fancy separators */
    .divider{height:1px;background:linear-gradient(90deg,transparent,#E6EDF6,transparent)}

    /* Header / Navbar */
    header.nav{
      position:sticky; top:0; z-index:1000;
      background:color-mix(in oklab, white 90%, transparent);
      backdrop-filter:saturate(160%) blur(8px);
      border-bottom:1px solid var(--stroke);
      transition:box-shadow var(--dur-2) var(--bezier), background var(--dur-2) var(--bezier), transform var(--dur-1) var(--bezier);
      will-change:transform;
    }
    .nav-inner{display:flex;align-items:center;justify-content:space-between;gap:16px;height:72px;max-width:1180px;margin:auto;padding:0 16px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.6px}
    .brand .mark{font-size:22px}
    .brand .mark .a{color:var(--kb-blue)}
    .brand .mark .b{color:var(--kb-green)}
    /* y√™u c·∫ßu: b·ªè slogan c·∫°nh logo -> kh√¥ng c√≥ <small> n·ªØa */

    .nav-list{display:none;gap:6px;flex-wrap:wrap}
    @media(min-width:1000px){.nav-list{display:flex}}
    .nav-link{border:0;background:transparent;padding:10px 12px;border-radius:10px;font-weight:700;color:#233348;cursor:pointer}
    .nav-link[aria-current="page"], .nav-link:hover{background:#eef6ff}

    .mobile-nav{display:flex; gap:10px}
    .mobile-select{display:block}
    @media(min-width:1000px){ .mobile-select{display:none} }

    /* Hero with animated mesh + parallax */
    .hero{
      position:relative;
      overflow:hidden;
      background:
        radial-gradient(800px 300px at 12% -30%, rgba(14,164,232,.15), transparent 60%),
        radial-gradient(600px 260px at 96% -20%, rgba(43,203,83,.12), transparent 60%),
        linear-gradient(180deg,#fff,#f8fbff 60%, #f3f6fb 100%);
    }
    .mesh{
      position:absolute; inset:-10% -20% auto -10%; height:60vh; min-height:360px; pointer-events:none; z-index:0;
      background: radial-gradient(800px 450px at 10% 20%, rgba(14,164,232,.18), transparent 60%),
                  radial-gradient(700px 420px at 90% 10%, rgba(43,203,83,.16), transparent 60%),
                  radial-gradient(600px 400px at 40% 80%, rgba(255,190,0,.20), transparent 65%);
      animation:floatMesh 14s var(--bezier) infinite alternate;
      filter:saturate(110%) blur(1px);
    }
    @keyframes floatMesh{
      0%{transform:translateY(-12px) scale(1)}
      100%{transform:translateY(6px) scale(1.02)}
    }
    .hero-grid{position:relative; z-index:1; display:grid; gap:20px; grid-template-columns:1fr}
    @media(min-width:900px){ .hero-grid{grid-template-columns:1.15fr 1fr} }
    .h1{font-size:var(--fs-hero);font-weight:900;line-height:1.08;margin:8px 0;letter-spacing:.2px}
    .lead{font-size:var(--fs-lead); color:var(--text-2)}
    .lift:hover{transform:translateY(-2px); box-shadow:var(--shadow-2)}

    /* Input & form */
    input,select,textarea{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #dfe6f2;background:#fff;transition:box-shadow var(--dur-1) var(--bezier)}
    input:hover,select:hover,textarea:hover{box-shadow:0 0 0 4px color-mix(in oklab, var(--kb-blue) 20%, transparent)}
    label span{display:block;font-size:12px;color:var(--text-2);margin-bottom:6px}

    /* Map container */
    #leafletMap{min-height:460px;border-radius:16px;border:1px solid var(--stroke);overflow:hidden}

    /* Scroll reveal */
    .reveal{opacity:.001; transform:translateY(16px) scale(.98); filter:blur(2px)}
    .reveal.inview{opacity:1; transform:none; filter:none; transition:opacity .7s var(--bezier), transform .7s var(--bezier), filter .7s var(--bezier)}

    /* Modal (patched, scrollable) */
    .modal{position:fixed;inset:0;background:rgba(9,12,20,.48);display:none;align-items:flex-start;justify-content:center;padding:40px;z-index:1200}
    .modal.active{display:flex}
    .modal .panel{
      max-width:980px;width:100%;border-radius:18px;background:#fff;border:1px solid var(--stroke);
      max-height:calc(100vh - 80px); overflow:auto; box-shadow:var(--shadow-2)
    }
    .md-grid{display:grid;grid-template-columns:1fr 1.2fr;gap:0}
    @media(max-width:900px){ .md-grid{grid-template-columns:1fr} }
    @media(max-width:680px){ .modal{padding:16px} }

    /* Footer */
    footer{border-top:1px solid var(--stroke)}
    .credits{display:flex;flex-wrap:wrap; gap:18px}

    /* Header shrinking on scroll */
    .shrink{transform:translateY(-2px); box-shadow:0 8px 24px rgba(10,20,35,.06)}

    /* Decorative gradient bar under section titles */
    .title-underline{height:3px;background:linear-gradient(90deg,var(--kb-blue),var(--kb-green),var(--kb-gold));border-radius:999px; width:100%; opacity:.25}

    /* Optional custom scrollbar (webkit) */
    ::-webkit-scrollbar{height:12px;width:12px}
    ::-webkit-scrollbar-thumb{background:linear-gradient(180deg,#cfe9fb,#bff0cd); border-radius:10px; border:3px solid transparent; background-clip:content-box}
    ::-webkit-scrollbar-track{background:transparent}

    /* [NEW] Styles for ROI Chart in Modal */
    .chart-wrapper{margin-top:20px}
    .chart-container{display:flex;gap:16px;align-items:flex-end;height:120px;border-bottom:1px solid var(--stroke);padding-bottom:10px}
    .chart-bar{width:100%;border-radius:6px 6px 0 0;position:relative;transition:height .5s var(--bezier)}
    .chart-bar .label{position:absolute;bottom:100%;left:50%;transform:translateX(-50%);margin-bottom:4px;background:var(--text);color:#fff;padding:2px 6px;border-radius:6px;font-size:11px;font-weight:700;white-space:nowrap}
    .chart-bar.revenue{background:linear-gradient(180deg, var(--kb-green), #24a845)}
    .chart-bar.cost{background:linear-gradient(180deg, var(--kb-gold), #d19d00)}
    .chart-legend{display:flex;gap:16px;margin-top:8px;font-size:12px}
    .legend-item{display:flex;align-items:center;gap:6px}
    .legend-dot{width:10px;height:10px;border-radius:99px}
    .kpi-table{width:100%;border-collapse:collapse;margin-top:14px}
    .kpi-table td{padding:8px;border-bottom:1px solid var(--stroke);font-size:13px}
    .kpi-table td:last-child{text-align:right;font-weight:700}

    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce){
      .reveal{opacity:1; transform:none; filter:none; transition:none}
      .mesh{animation:none}
      html{scroll-behavior:auto}
      .btn,.lift{transition:none}
      header.nav{transition:none}
      .chart-bar{transition:none}
    }
  </style>
</head>

<body>
  <a class="sr-only skip" href="#main">B·ªè qua ƒë·∫øn n·ªôi dung ch√≠nh</a>

  <!-- ==============================
       HEADER / NAVBAR (no slogan near logo)
       ============================== -->
  <header class="nav" id="navbar">
    <div class="nav-inner">
      <a class="brand" href="#home" aria-label="Trang ch·ªß KINGBULL">
        <div class="mark"><span class="a">KING</span><span class="b">BULL</span></div>
      </a>

      <nav class="nav-list" aria-label="ƒêi·ªÅu h∆∞·ªõng">
        <a class="nav-link" href="#home">Home</a>
        <a class="nav-link" href="#cases">Case Study</a>
        <a class="nav-link" href="#library">Th∆∞ vi·ªán PDF</a>
        <a class="nav-link" href="#videos">Video</a>
        <a class="nav-link" href="#dealer">ƒê·∫°i l√Ω</a>
        <a class="nav-link" href="#supply">B·∫£n ƒë·ªì</a>
        <a class="nav-link" href="#support">H·ªó tr·ª£ 24/7</a>
        <a class="nav-link" href="#logistics">Logistics</a>
        <a class="nav-link" href="#news">Tin t·ª©c</a>
        <a class="nav-link" href="#rd">H·ª£p t√°c R&D</a>
      </nav>

      <div class="mobile-nav">
        <select class="mobile-select" id="mobileSelect" aria-label="Ch·ªçn m·ª•c">
          <option value="#home">Home</option>
          <option value="#cases">Case Study</option>
          <option value="#library">Th∆∞ vi·ªán PDF</option>
          <option value="#videos">Video</option>
          <option value="#dealer">ƒê·∫°i l√Ω</option>
          <option value="#supply">B·∫£n ƒë·ªì</option>
          <option value="#support">H·ªó tr·ª£ 24/7</option>
          <option value="#logistics">Logistics</option>
          <option value="#news">Tin t·ª©c</option>
          <option value="#rd">H·ª£p t√°c R&D</option>
        </select>
      </div>
    </div>
  </header>

  <!-- ==============================
       MAIN
       ============================== -->
  <main id="main">

    <!-- ============ HERO ============ -->
    <section id="home" class="section hero">
      <div class="mesh" aria-hidden="true"></div>
      <div class="container hero-grid">
        <div class="reveal">
          <span class="pill">Aquafeed B2B ‚Ä¢ Vi·ªát Nam</span>
          <h1 class="h1 lift" id="heroTitle">KINGBULL ‚Äî <span style="color:var(--kb-blue)">Chuy√™n nghi·ªáp</span>, <span style="color:var(--kb-green)">Tin c·∫≠y</span>, <span style="color:var(--kb-gold)">H∆∞·ªõng k·∫øt qu·∫£</span></h1>
          <p class="lead">NƒÉng l·ª±c s·∫£n xu·∫•t & cung ·ª©ng quy m√¥ l·ªõn, t·ªëi ∆∞u l·ª£i nhu·∫≠n cho ƒë·∫°i l√Ω v√† trang tr·∫°i nu√¥i quy m√¥. H·ªá gi·∫£i ph√°p k·ªπ thu·∫≠t & t√†i ch√≠nh r√µ r√†ng theo ROI.</p>
          <div class="k-m">
            <a class="btn primary" href="#cases">Xem H·ªì s∆° D·ª± √°n Th√†nh c√¥ng</a>
            <a class="btn ghost" href="#support" style="margin-left:8px">Li√™n h·ªá H·ª£p t√°c</a>
          </div>

          <div class="row col-3 k-m">
            <div class="card pad lift"><small class="hint">NƒÉng l·ª±c cung ·ª©ng</small><div><b>> 100.000 t·∫•n/nƒÉm</b></div></div>
            <div class="card pad lift"><small class="hint">M·∫°ng l∆∞·ªõi ph√¢n ph·ªëi</small><div><b>63 t·ªânh th√†nh</b></div></div>
            <div class="card pad lift"><small class="hint">H·ªó tr·ª£ k·ªπ thu·∫≠t</small><div><b>24/7</b></div></div>
          </div>
        </div>

        <div class="card lift reveal">
          <iframe title="Flycam nh√† m√°y" class="thumb" style="border-radius:16px 16px 0 0"
            src="https://www.youtube.com/embed/1La4QzGeaaQ"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
          <div class="pad" style="padding:12px 16px"><div class="hint">Video flycam to√†n c·∫£nh nh√† m√°y</div></div>
        </div>
      </div>

      <div class="divider"></div>
    </section>

    <!-- ============ CASE STUDIES ============ -->
    <section id="cases" class="section">
      <div class="container">
        <div class="title reveal"><span class="bar"></span><span>H·ªì s∆° d·ª± √°n nu√¥i th√†nh c√¥ng</span></div>
        <div class="title-underline reveal" style="margin-top:10px"></div>
        <p class="hint reveal">D·ªØ li·ªáu ROI minh b·∫°ch ‚Äî video, h√¨nh ·∫£nh & nh·∫≠n x√©t ch·ªß tr·∫°i</p>

        <div class="k-m reveal" style="display:flex;align-items:center;gap:10px">
          <label style="max-width:260px"><span>Lo√†i nu√¥i</span><select id="caseFilter"></select></label>
        </div>

        <div class="row col-3 k-m" id="caseList" aria-live="polite"></div>
      </div>
      <div class="divider"></div>
    </section>

    <!-- ============ LIBRARY ============ -->
    <section id="library" class="section muted">
      <div class="container">
        <div class="title reveal"><span class="bar"></span><span>Th∆∞ vi·ªán k·ªπ thu·∫≠t chuy√™n s√¢u</span></div>
        <div class="title-underline reveal" style="margin-top:10px"></div>
        <p class="hint reveal">PDF: FCR, ph√≤ng b·ªánh, qu·∫£n l√Ω m√¥i tr∆∞·ªùng n∆∞·ªõc, t·ªëi ∆∞u v√≤ng quay v·ªën</p>

        <div class="row col-3 k-m reveal" style="gap:12px">
          <label><span>Lo√†i</span><select id="pdfSpecies"></select></label>
          <label><span>Giai ƒëo·∫°n</span><select id="pdfStage"></select></label>
          <label><span>M·ª•c ti√™u</span><select id="pdfGoal"></select></label>
        </div>

        <div class="row col-3 k-m" id="pdfList"></div>
      </div>
      <div class="divider"></div>
    </section>

    <!-- ============ VIDEOS ============ -->
    <section id="videos" class="section">
      <div class="container">
        <div class="title reveal"><span class="bar"></span><span>Video quy tr√¨nh s·∫£n xu·∫•t & nƒÉng l·ª±c nh√† m√°y</span></div>
        <div class="title-underline reveal" style="margin-top:10px"></div>
        <div class="row col-3 k-m" id="videoList"></div>
        <div class="row col-4 k-m reveal" style="grid-template-columns:repeat(4,1fr)">
          <img class="thumb lift" alt="Kho l·∫°nh" src="https://images.unsplash.com/photo-1541911087797-f89237bd95d6?q=80&w=1200&auto=format&fit=crop" />
          <img class="thumb lift" alt="Container xu·∫•t h√†ng" src="https://images.unsplash.com/photo-1544989164-31dc3c645987?q=80&w=1200&auto=format&fit=crop" />
          <img class="thumb lift" alt="Ki·ªÉm ƒë·ªãnh ch·∫•t l∆∞·ª£ng" src="https://images.unsplash.com/photo-1581090700227-1e37b190418e?q=80&w=1200&auto=format&fit=crop" />
          <img class="thumb lift" alt="D√¢y chuy·ªÅn s·∫£n xu·∫•t" src="https://images.unsplash.com/photo-1581093588401-a1b1a1c5381e?q=80&w=1200&auto=format&fit=crop" />
        </div>
      </div>
      <div class="divider"></div>
    </section>

    <!-- ============ DEALER PORTAL ============ -->
    <section id="dealer" class="section muted">
      <div class="container">
        <div class="title reveal"><span class="bar"></span><span>Khu v·ª±c D√†nh cho ƒê·∫°i l√Ω & Trang tr·∫°i</span></div>
        <div class="title-underline reveal" style="margin-top:10px"></div>
        <p class="hint reveal">ƒêƒÉng nh·∫≠p ƒë·ªÉ xem t√†i li·ªáu n·ªôi b·ªô (b·∫£ng gi√°, policy, training)</p>
        <div id="dealerBox" class="k-m reveal" style="max-width:800px"></div>
      </div>
      <div class="divider"></div>
    </section>

    <!-- ============ SUPPLY MAP ============ -->
    <section id="supply" class="section">
      <div class="container">
        <div class="title reveal"><span class="bar"></span><span>B·∫£n ƒë·ªì nƒÉng l·ª±c cung ·ª©ng</span></div>
        <div class="title-underline reveal" style="margin-top:10px"></div>
        <p class="hint reveal">V√πng ph√¢n ph·ªëi, kho b√£i, th·ªùi gian giao h√†ng d·ª± ki·∫øn ‚Äî d√πng d·ªØ li·ªáu m√¥ ph·ªèng</p>

        <div class="k-m reveal" style="display:flex;align-items:center;gap:10px">
          <label style="max-width:220px"><span>Khu v·ª±c</span><select id="regionFilter">
            <option>T·∫•t c·∫£</option><option>ƒêBSCL</option><option>Mi·ªÅn Nam</option><option>Mi·ªÅn Trung</option><option>Mi·ªÅn B·∫Øc</option>
          </select></label>
        </div>

        <div class="k-m reveal"><div id="leafletMap" class="lift"></div></div>
      </div>
      <div class="divider"></div>
    </section>

    <!-- ============ SUPPORT ============ -->
    <section id="support" class="section muted">
      <div class="container">
        <div class="title reveal"><span class="bar"></span><span>H·ªó tr·ª£ k·ªπ thu·∫≠t 24/7</span></div>
        <div class="title-underline reveal" style="margin-top:10px"></div>

        <div class="row col-3" style="grid-template-columns: 1fr 2fr">
          <div class="card pad lift reveal">
            <b>Li√™n h·ªá nhanh</b>
            <div class="k-m" style="display:grid;gap:8px">
              <a class="btn primary" href="tel:+84587085649">G·ªçi Hotline k·ªπ thu·∫≠t</a>
              <a class="btn" href="https://zalo.me/0587085649" target="_blank" rel="noreferrer">Chat Zalo OA</a>
              <a class="btn" href="mailto:admin@kingbull.com.vn">G·ª≠i Email</a>
            </div>
            <div class="k-m hint">
              <div><b>ƒê·ªãa ch·ªâ:</b> T·∫ßng 6, s·ªë 41, CMT8, P. C√°i Kh·∫ø, C·∫ßn Th∆°</div>
              <div><b>ƒêi·ªán tho·∫°i:</b> 058.708.5649</div>
              <div><b>Email:</b> admin@kingbull.com.vn</div>
            </div>
          </div>

          <form id="supportForm" class="card pad lift reveal">
            <b>ƒê·∫∑t l·ªãch h·∫πn v·ªõi chuy√™n gia</b>
            <div class="row col-2 k-m">
              <label><span>H·ªç t√™n</span><input required id="spName" placeholder="Nguy·ªÖn VƒÉn A"/></label>
              <label><span>S·ªë ƒëi·ªán tho·∫°i</span><input required id="spPhone" placeholder="09xx xxx xxx"/></label>
              <label><span>Khu v·ª±c</span>
                <select required id="spRegion">
                  <option value="">Ch·ªçn</option><option>ƒêBSCL</option><option>Mi·ªÅn Nam</option><option>Mi·ªÅn Trung</option><option>Mi·ªÅn B·∫Øc</option>
                </select>
              </label>
              <label><span>Ghi ch√∫</span><input id="spNote" placeholder="Quy m√¥ tr·∫°i, lo√†i nu√¥i..."/></label>
            </div>
            <div class="k-m"><button class="btn green" type="submit">ƒê·∫∑t l·ªãch</button></div>
            <div id="supportMsg" class="hint k-m" role="status"></div>
          </form>
        </div>
      </div>
      <div class="divider"></div>
    </section>

    <!-- ============ LOGISTICS ============ -->
    <section id="logistics" class="section">
      <div class="container">
        <div class="title reveal"><span class="bar"></span><span>C√¥ng c·ª• T√≠nh Logistics & Kho B√£i</span></div>
        <div class="title-underline reveal" style="margin-top:10px"></div>

        <form id="logiForm" class="card pad k-m lift reveal" style="max-width:900px">
          <div class="row col-3">
            <label><span>S·ªë l∆∞·ª£ng (t·∫•n)</span><input type="number" min="1" id="qtyTon" value="50"/></label>
            <label><span>ƒê·ªãa ƒëi·ªÉm giao</span><select id="destSelect"></select></label>
            <div style="align-self:end"><button class="btn primary" type="submit" style="width:100%">T√≠nh m√¥ ph·ªèng</button></div>
          </div>
          <div id="logiResult" class="row col-4 k-m" style="display:none"></div>
        </form>
      </div>
      <div class="divider"></div>
    </section>

    <!-- ============ NEWS ============ -->
    <section id="news" class="section muted">
      <div class="container">
        <div class="title reveal"><span class="bar"></span><span>Tin t·ª©c ng√†nh & ph√¢n t√≠ch th·ªã tr∆∞·ªùng</span></div>
        <div class="title-underline reveal" style="margin-top:10px"></div>

        <div class="k-m reveal" style="display:flex;align-items:center;gap:10px">
          <label style="max-width:240px"><span>Ch·ªß ƒë·ªÅ</span><select id="newsFilter"></select></label>
        </div>
        <div class="row col-3 k-m" id="newsList"></div>
      </div>
      <div class="divider"></div>
    </section>

    <!-- ============ R&D ============ -->
    <section id="rd" class="section">
      <div class="container">
        <div class="title reveal"><span class="bar"></span><span>Ch∆∞∆°ng tr√¨nh h·ª£p t√°c R&D</span></div>
        <div class="title-underline reveal" style="margin-top:10px"></div>

        <div class="row col-2 k-m">
          <div class="card pad lift reveal">
            <b>Gi·ªõi thi·ªáu</b>
            <ul class="k-m hint" style="line-height:1.9">
              <li>ƒê·ªìng ph√°t tri·ªÉn c√¥ng th·ª©c cho t·ª´ng lo√†i/giai ƒëo·∫°n.</li>
              <li>Th·ª≠ nghi·ªám th·ª±c ƒë·ªãa c√≥ gi√°m s√°t KPI r√µ r√†ng.</li>
              <li>Chia s·∫ª d·ªØ li·ªáu (·∫©n danh) v√† c√¥ng b·ªë khoa h·ªçc.</li>
            </ul>
          </div>

          <form id="rdForm" class="card pad lift reveal">
            <b>ƒêƒÉng k√Ω h·ª£p t√°c</b>
            <label class="k-m"><span>T·ªï ch·ª©c/ƒê∆°n v·ªã</span><input required id="rdOrg" placeholder="Vi·ªán/Tr∆∞·ªùng/Doanh nghi·ªáp"/></label>
            <label class="k-m"><span>Ng∆∞·ªùi li√™n h·ªá</span><input required id="rdContact" placeholder="H·ªç t√™n & Email"/></label>
            <label class="k-m"><span>ƒê·ªÅ xu·∫•t ng·∫Øn g·ªçn</span><textarea required id="rdProposal" rows="4" placeholder="M·ª•c ti√™u, quy m√¥, th·ªùi gian..."></textarea></label>
            <div class="k-m"><button class="btn green" type="submit">G·ª≠i ƒë·ªÅ xu·∫•t</button></div>
            <div id="rdMsg" class="hint k-m" role="status"></div>
          </form>
        </div>
      </div>
      <div class="divider"></div>
    </section>
  </main>

  <!-- ============ FOOTER ============ -->
  <footer class="section">
    <div class="container">
      <div class="credits">
        <div>
          <div class="brand"><div class="mark"><span class="a" style="color:var(--kb-blue)">KING</span><span class="b" style="color:var(--kb-green)">BULL</span></div></div>
          <div class="hint">‚Äúƒê·ªôt ph√° tƒÉng tr∆∞·ªüng, d·∫´n ƒë·∫ßu l·ª£i nhu·∫≠n‚Äù</div>
        </div>
        <div class="hint">
          <div><b>Doanh nghi·ªáp:</b> C√îNG TY TNHH KINGBULL VI·ªÜT NAM</div>
          <div><b>MST:</b> 1801608521</div>
          <div><b>ƒê·ªãa ch·ªâ:</b> T·∫ßng 6, s·ªë 41, CMT8, P. C√°i Kh·∫ø, TP C·∫ßn Th∆°, Vi·ªát Nam</div>
        </div>
        <div class="hint">
          <div><b>Email:</b> admin@kingbull.com.vn</div>
          <div><b>ƒêi·ªán tho·∫°i:</b> 058.708.5649</div>
          <div class="k-m" style="display:flex;gap:8px">
            <a class="btn" href="tel:+84587085649">Hotline</a>
            <a class="btn" href="https://zalo.me/0587085649" target="_blank" rel="noreferrer">Zalo OA</a>
          </div>
        </div>
      </div>
      <div class="hint k-m">¬© <span id="year"></span> KINGBULL Vi·ªát Nam. All rights reserved.</div>
    </div>
  </footer>

  <!-- ============ MODAL ============ -->
  <div id="modal" class="modal" aria-modal="true" role="dialog" hidden>
    <div class="panel">
      <div class="pad" style="display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--stroke);">
        <div><b id="mdTitle">Chi ti·∫øt d·ª± √°n</b><div class="hint" id="mdSub"></div></div>
        <button class="btn" id="mdClose" aria-label="ƒê√≥ng">ƒê√≥ng</button>
      </div>
      <div id="mdBody" class="pad"></div>
    </div>
  </div>

  <!-- ============================================================
       SCRIPTS
       ============================================================ -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    /* ------------------------------------------------------------
       Data (dummy, expanded)
       ------------------------------------------------------------ */
    const CASE_STUDIES = [
      { id:1, name:"Ao nu√¥i c√° tra A1 - C·∫ßn Th∆°", species:"C√° tra", areaHa:5, cycleDays:180, harvestTons:600, fcr:1.5, feedCostPerKg:12000, pricePerKg:25000, survivalRate: 0.85, started:"2024-03-01", finished:"2024-08-30",
        images:["https://images.unsplash.com/photo-1593262109328-154f3fb9d29f?q=80&w=1200&auto=format&fit=crop"],
        video:"https://www.youtube.com/embed/1La4QzGeaaQ", ownerNote:"Th·ª©c ƒÉn ·ªïn ƒë·ªãnh, tƒÉng tr∆∞·ªüng ƒë·ªìng ƒë·ªÅu, t·ª∑ l·ªá s·ªëng cao." },
      { id:2, name:"R√¥ phi si√™u th√¢m canh - Long An", species:"C√° r√¥ phi", areaHa:2.5, cycleDays:150, harvestTons:220, fcr:1.35, feedCostPerKg:11500, pricePerKg:32000, survivalRate: 0.92, started:"2024-02-15", finished:"2024-07-20",
        images:["https://images.unsplash.com/photo-1576765608610-5f4e01aa12c4?q=80&w=1200&auto=format&fit=crop"],
        video:"https://www.youtube.com/embed/aqz-KE-bpKQ", ownerNote:"T·ªëi ∆∞u FCR, gi·∫£m hao h·ª•t nh·ªù qu·∫£n tr·ªã n∆∞·ªõc t·ªët." },
      { id:3, name:"C√° l√≥c th∆∞∆°ng ph·∫©m - An Giang", species:"C√° l√≥c", areaHa:1.2, cycleDays:120, harvestTons:95, fcr:1.6, feedCostPerKg:12500, pricePerKg:38000, survivalRate: 0.90, started:"2024-04-10", finished:"2024-08-10",
        images:["https://images.unsplash.com/photo-1517837016564-bfcf7a7c89d6?q=80&w=1200&auto=format&fit=crop"],
        video:"https://www.youtube.com/embed/oUFJJNQGwhk", ownerNote:"TƒÉng tr∆∞·ªüng nhanh, m√†u th·ªãt ƒë·∫πp, ƒë·∫ßu ra ·ªïn ƒë·ªãnh." },
      { id:4, name:"T√¥m s√∫ c√¥ng nghi·ªáp - B·∫°c Li√™u", species:"T√¥m s√∫", areaHa:3, cycleDays:110, harvestTons:15, fcr:1.7, feedCostPerKg:28000, pricePerKg:220000, survivalRate: 0.80, started:"2024-05-01", finished:"2024-08-20",
        images:["https://images.unsplash.com/photo-1601841382901-b113458de10a?q=80&w=1200&auto=format&fit=crop"],
        video:"https://www.youtube.com/embed/1La4QzGeaaQ", ownerNote:"Ch·∫•t l∆∞·ª£ng t√¥m ƒë·∫°t chu·∫©n xu·∫•t kh·∫©u, gi√° b√°n cao." },
      { id:5, name:"C√° di√™u h·ªìng l·ªìng b√® - ƒê·ªìng Nai", species:"C√° di√™u h·ªìng", areaHa:0.8, cycleDays:160, harvestTons:120, fcr:1.4, feedCostPerKg:11800, pricePerKg:35000, survivalRate: 0.88, started:"2024-03-20", finished:"2024-08-28",
        images:["https://images.unsplash.com/photo-1499125562588-29fb8a56b5d5?q=80&w=1200&auto=format&fit=crop"],
        video:"https://www.youtube.com/embed/aqz-KE-bpKQ", ownerNote:"M√¥ h√¨nh l·ªìng b√® hi·ªáu qu·∫£, c√° kh·ªèe, √≠t b·ªánh." },
    ];

    const PDF_LIBRARY = [
      { id:"pdf1", title:"T·ªëi ∆∞u FCR cho C√° tra", species:"C√° tra", stage:"TƒÉng tr∆∞·ªüng", goal:"T·ªëi ∆∞u chi ph√≠", url:"#"},
      { id:"pdf2", title:"Ph√≤ng b·ªánh m√πa m∆∞a (C√° r√¥ phi)", species:"C√° r√¥ phi", stage:"Ph√≤ng b·ªánh", goal:"An to√†n sinh h·ªçc", url:"#"},
      { id:"pdf3", title:"Qu·∫£n l√Ω m√¥i tr∆∞·ªùng ao ƒë·∫•t", species:"C√° l√≥c", stage:"M√¥i tr∆∞·ªùng", goal:"·ªîn ƒë·ªãnh nƒÉng su·∫•t", url:"#"},
      { id:"pdf4", title:"T·ªëi ∆∞u v√≤ng quay v·ªën (360¬∞)", species:"C√° tra", stage:"T√†i ch√≠nh", goal:"T·ªëi ∆∞u v·ªën", url:"#"},
      { id:"pdf5", title:"Qu·∫£n l√Ω d·ªãch b·ªánh cho T√¥m s√∫", species:"T√¥m s√∫", stage:"Ph√≤ng b·ªánh", goal:"An to√†n sinh h·ªçc", url:"#"},
      { id:"pdf6", title:"TƒÉng t·ª∑ l·ªá s·ªëng cho c√° gi·ªëng", species:"C√° di√™u h·ªìng", stage:"∆Ø∆°ng gi·ªëng", goal:"TƒÉng hi·ªáu qu·∫£", url:"#"},
      { id:"pdf7", title:"T·ª± ƒë·ªông h√≥a cho ƒÉn", species:"T·∫•t c·∫£", stage:"V·∫≠n h√†nh", goal:"T·ªëi ∆∞u nh√¢n c√¥ng", url:"#"},
    ];

    const VIDEO_GALLERY = [
      { id:"v1", title:"Flycam to√†n c·∫£nh nh√† m√°y", src:"https://www.youtube.com/embed/1La4QzGeaaQ" },
      { id:"v2", title:"D√¢y chuy·ªÅn s·∫£n xu·∫•t t·ª± ƒë·ªông", src:"https://www.youtube.com/embed/aqz-KE-bpKQ" },
      { id:"v3", title:"Kho l·∫°nh & container xu·∫•t", src:"https://www.youtube.com/embed/oUFJJNQGwhk" },
    ];

    const WAREHOUSES = [
      { id:"dc1", name:"C·∫ßn Th∆° DC", region:"ƒêBSCL", lat:10.045, lng:105.746 },
      { id:"dc2", name:"Long An DC", region:"ƒêBSCL", lat:10.695, lng:106.242 },
      { id:"dc3", name:"H·ªì Ch√≠ Minh Hub", region:"Mi·ªÅn Nam", lat:10.823, lng:106.629 },
      { id:"dc4", name:"Nha Trang Node", region:"Mi·ªÅn Trung", lat:12.238, lng:109.196 },
      { id:"dc5", name:"H·∫£i Ph√≤ng Port", region:"Mi·ªÅn B·∫Øc", lat:20.861, lng:106.683 },
    ];

    const DESTINATIONS = [
      { id:"dst1", name:"An Giang (c√° tra)", region:"ƒêBSCL", lat:10.375, lng:105.420 },
      { id:"dst2", name:"B·∫°c Li√™u (t√¥m)", region:"ƒêBSCL", lat:9.294, lng:105.727 },
      { id:"dst3", name:"C√† Mau (t√¥m/c√°)", region:"ƒêBSCL", lat:9.176, lng:105.152 },
      { id:"dst4", name:"Qu·∫£ng Nam (c√° r√¥ phi)", region:"Mi·ªÅn Trung", lat:15.573, lng:108.474 },
      { id:"dst5", name:"H·∫£i D∆∞∆°ng (c√° l√≥c)", region:"Mi·ªÅn B·∫Øc", lat:20.938, lng:106.320 },
      { id:"dst6", name:"ƒê·ªìng Nai (c√° di√™u h·ªìng)", region:"Mi·ªÅn Nam", lat:10.95, lng:106.82 },
    ];

    const NEWS = [
      { id:"n1", tag:"Gi√° nguy√™n li·ªáu", title:"B·ªôt c√° ·ªïn ƒë·ªãnh, d·∫ßu ƒë·∫≠u n√†nh tƒÉng nh·∫π", date:"2025-07-28", excerpt:"Gi√° d·∫ßu ƒë·∫≠u n√†nh tƒÉng 2.1% do ngu·ªìn cung th·∫Øt ch·∫∑t; b·ªôt c√° gi·ªØ m·ª©c ·ªïn ƒë·ªãnh theo qu√Ω."},
      { id:"n2", tag:"Xu·∫•t kh·∫©u", title:"Nhu c·∫ßu th·ªã tr∆∞·ªùng Trung ƒê√¥ng tƒÉng", date:"2025-07-15", excerpt:"C√°c nh√† nh·∫≠p kh·∫©u tƒÉng ƒë∆°n h√†ng d√≤ng premium; y√™u c·∫ßu ch·ª©ng nh·∫≠n truy xu·∫•t ngu·ªìn g·ªëc."},
      { id:"n3", tag:"D·ªãch b·ªánh", title:"C·∫£nh b√°o Vibrio v√πng ven bi·ªÉn mi·ªÅn Trung", date:"2025-06-30", excerpt:"Khuy·∫øn ngh·ªã tƒÉng c∆∞·ªùng s√°t tr√πng, qu·∫£n tr·ªã t·∫£o, b·ªï sung probiotics giai ƒëo·∫°n chuy·ªÉn m√πa."},
      { id:"n4", tag:"C√¥ng ngh·ªá", title:"·ª®ng d·ª•ng AI trong qu·∫£n l√Ω ao nu√¥i", date:"2025-06-15", excerpt:"C√°c c·∫£m bi·∫øn IoT v√† AI gi√∫p d·ª± b√°o ch·∫•t l∆∞·ª£ng n∆∞·ªõc v√† t·ªëi ∆∞u h√≥a l·ªãch cho ƒÉn, gi·∫£m FCR t·ªõi 5%."},
      { id:"n5", tag:"Th·ªã tr∆∞·ªùng", title:"Gi√° c√° tra xu·∫•t kh·∫©u d·ª± b√°o tƒÉng cu·ªëi nƒÉm", date:"2025-05-28", excerpt:"Nhu c·∫ßu t·ª´ th·ªã tr∆∞·ªùng EU v√† M·ªπ tƒÉng tr·ªü l·∫°i, d·ª± b√°o gi√° c√° nguy√™n li·ªáu s·∫Ω tƒÉng nh·∫π trong Qu√Ω 4."},
    ];

    /* ------------------------------------------------------------
       Helpers (vanilla)
       ------------------------------------------------------------ */
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const fmtVND = n => (Math.round(n)).toLocaleString("vi-VN")+" ‚Ç´";
    const ceil = Math.ceil;

    function distanceKm(a,b){
      const toRad = d=>d*Math.PI/180, R=6371;
      const dLat = toRad(b.lat - a.lat), dLng = toRad(b.lng - a.lng);
      const s1 = Math.sin(dLat/2)**2 + Math.cos(toRad(a.lat))*Math.cos(toRad(b.lat))*Math.sin(dLng/2)**2;
      return 2*R*Math.atan2(Math.sqrt(s1), Math.sqrt(1-s1));
    }

    /* ------------------------------------------------------------
       Landing nav behaviors
       ------------------------------------------------------------ */
    function setupActiveNav(){
      const sections = ["home","cases","library","videos","dealer","supply","support","logistics","news","rd"].map(id=>$("#"+id));
      const navLinks = $$(".nav-link");
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){
            const id = e.target.id;
            navLinks.forEach(a => a.setAttribute("aria-current", a.getAttribute("href")==="#"+id ? "page" : "false"));
          }
        });
      }, {rootMargin:"-48% 0px -48% 0px", threshold: [0, .25, .5, .75, 1]});
      sections.forEach(s=>io.observe(s));
      $("#mobileSelect").addEventListener("change", (e)=> location.hash = e.target.value);
    }

    function setupScrollFX(){
      const navbar = $("#navbar");
      const heroTitle = $("#heroTitle");
      window.addEventListener("scroll", ()=>{
        const y = window.scrollY || document.documentElement.scrollTop;
        if(y>10) navbar.classList.add("shrink"); else navbar.classList.remove("shrink");
        const amt = Math.min(1, y/400);
        heroTitle.style.transform = `translateY(${amt*6}px)`;
        heroTitle.style.opacity = String(1 - amt*0.15);
      }, {passive:true});
    }

    function setupReveal(){
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add("inview"); io.unobserve(e.target); } });
      }, {rootMargin:"-10% 0px -10% 0px", threshold: 0.1});
      $$(".reveal").forEach(el=>io.observe(el));
    }

    /* ------------------------------------------------------------
       Renderers
       ------------------------------------------------------------ */
    function renderCaseStudies(){
      const speciesList = ["T·∫•t c·∫£", ...new Set(CASE_STUDIES.map(c=>c.species))];
      speciesList.forEach(s=>$("#caseFilter").append(new Option(s,s)));
      $("#caseFilter").addEventListener("change", draw);
      draw();
      function draw(){
        const f = $("#caseFilter").value || "T·∫•t c·∫£";
        const data = CASE_STUDIES.filter(x=> f==="T·∫•t c·∫£" || x.species===f);
        const wrap = $("#caseList"); wrap.innerHTML="";
        data.forEach(item=>{
          const revenue = item.harvestTons*1000*item.pricePerKg;
          const feedCost = item.harvestTons*1000*item.fcr*item.feedCostPerKg;
          const roi = (revenue - feedCost)/feedCost*100;

          const d=document.createElement("div"); d.className="card pad lift reveal";
          d.innerHTML = `
            <img class="thumb" src="${item.images[0]}" alt="Ao nu√¥i - ${item.name}">
            <div class="k-m"><b>${item.name}</b> <span class="pill">${item.species}</span></div>
            <div class="k-m hint">S·∫£n l∆∞·ª£ng: <b>${item.harvestTons} t·∫•n</b> ‚Ä¢ FCR: <b>${item.fcr}</b> ‚Ä¢ Chu k·ª≥: <b>${item.cycleDays} ng√†y</b></div>
            <div class="row col-2 k-m">
              <div class="card pad"><small class="hint">Doanh thu</small><div><b>${fmtVND(revenue)}</b></div></div>
              <div class="card pad"><small class="hint">ROI (th·ª©c ƒÉn)</small><div><b style="color:var(--kb-green)">${roi.toFixed(1)}%</b></div></div>
            </div>
            <div class="k-m"><button class="btn primary" data-open="${item.id}">Xem Ph√¢n t√≠ch Chi ti·∫øt</button></div>
          `;
          wrap.appendChild(d);
        });
        wrap.querySelectorAll("[data-open]").forEach(btn=>{
          btn.addEventListener("click", ()=>{
            const item = CASE_STUDIES.find(c=>c.id==btn.dataset.open);
            openCaseModal(item);
          });
        });
      }
    }

    function openCaseModal(item){
      $("#mdTitle").textContent = item.name;
      $("#mdSub").textContent = `${item.species} ‚Ä¢ ${item.started} ‚Üí ${item.finished}`;
      const revenue = item.harvestTons*1000*item.pricePerKg;
      const feedCost = item.harvestTons*1000*item.fcr*item.feedCostPerKg;
      const net = revenue - feedCost;
      const roi = net/feedCost*100;
      const profitPerHa = net / item.areaHa;

      const maxVal = revenue;
      const revenuePercent = 100;
      const costPercent = (feedCost / maxVal) * 100;

      $("#mdBody").innerHTML = `
        <div class="md-grid">
          <div>
            <iframe title="Video - ${item.name}" class="thumb" style="border-radius:0"
              src="${item.video}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
            <div class="pad"><b>Nh·∫≠n x√©t c·ªßa ch·ªß trang tr·∫°i:</b><div class="hint k-m">‚Äú${item.ownerNote}‚Äù</div></div>
          </div>
          <div class="pad">
            <b>Ph√¢n t√≠ch hi·ªáu qu·∫£ (d·ª±a tr√™n chi ph√≠ th·ª©c ƒÉn)</b>
            <div class="chart-wrapper">
              <div class="chart-container">
                <div class="chart-bar revenue" style="height:${revenuePercent}%"><span class="label">${fmtVND(revenue)}</span></div>
                <div class="chart-bar cost" style="height:${costPercent}%"><span class="label">${fmtVND(feedCost)}</span></div>
              </div>
              <div class="chart-legend">
                <div class="legend-item"><span class="legend-dot" style="background:var(--kb-green)"></span>Doanh thu</div>
                <div class="legend-item"><span class="legend-dot" style="background:var(--kb-gold)"></span>Chi ph√≠ th·ª©c ƒÉn</div>
              </div>
            </div>
            <div class="k-m">
              <b>Ch·ªâ s·ªë hi·ªáu su·∫•t ch√≠nh (KPIs)</b>
              <table class="kpi-table">
                <tr><td>T·ªïng doanh thu</td><td>${fmtVND(revenue)}</td></tr>
                <tr><td>Chi ph√≠ th·ª©c ƒÉn</td><td>${fmtVND(feedCost)}</td></tr>
                <tr><td>L·ª£i nhu·∫≠n g·ªôp (∆∞·ªõc t√≠nh)</td><td>${fmtVND(net)}</td></tr>
                <tr><td><b>ROI (tr√™n chi ph√≠ th·ª©c ƒÉn)</b></td><td><b>${roi.toFixed(1)}%</b></td></tr>
                <tr><td>L·ª£i nhu·∫≠n / hecta</td><td>${fmtVND(profitPerHa)}</td></tr>
                <tr><td>T·ª∑ l·ªá s·ªëng</td><td>${item.survivalRate*100}%</td></tr>
              </table>
            </div>
          </div>
        </div>
      `;
      const modal = $("#modal"); modal.hidden=false; modal.classList.add("active"); $("#mdClose").focus();
    }
    $("#mdClose").addEventListener("click", ()=> { $("#modal").classList.remove("active"); $("#modal").hidden=true; });
    $("#modal").addEventListener("click", (e)=>{ if(e.target.id==="modal"){ $("#modal").classList.remove("active"); $("#modal").hidden=true; }});
    document.addEventListener("keydown", e=>{ if(e.key==="Escape"){ $("#modal").classList.remove("active"); $("#modal").hidden=true; }});

    function renderPDF(){
      const allSpecies = [...new Set(PDF_LIBRARY.map(x=>x.species))];
      const species = ["T·∫•t c·∫£", ...allSpecies.filter(s=>s!=="T·∫•t c·∫£")];
      const stages  = ["T·∫•t c·∫£", ...new Set(PDF_LIBRARY.map(x=>x.stage))];
      const goals   = ["T·∫•t c·∫£", ...new Set(PDF_LIBRARY.map(x=>x.goal))];
      const sp=$("#pdfSpecies"), st=$("#pdfStage"), go=$("#pdfGoal");
      species.forEach(v=>sp.append(new Option(v,v)));
      stages.forEach(v=>st.append(new Option(v,v)));
      goals.forEach(v=>go.append(new Option(v,v)));
      sp.addEventListener("change",draw); st.addEventListener("change",draw); go.addEventListener("change",draw);
      draw();

      function draw(){
        const f1=sp.value||"T·∫•t c·∫£", f2=st.value||"T·∫•t c·∫£", f3=go.value||"T·∫•t c·∫£";
        const data = PDF_LIBRARY.filter(x=>
          (f1==="T·∫•t c·∫£"||x.species===f1||x.species==="T·∫•t c·∫£") && (f2==="T·∫•t c·∫£"||x.stage===f2) && (f3==="T·∫•t c·∫£"||x.goal===f3)
        );
        const wrap=$("#pdfList"); wrap.innerHTML="";
        data.forEach(x=>{
          const d=document.createElement("div"); d.className="card pad lift reveal";
          d.innerHTML=`<b>${x.title}</b>
          <div class="k-m" style="display:flex;gap:6px;flex-wrap:wrap">
            <span class="pill">${x.species}</span><span class="pill">${x.stage}</span><span class="pill">${x.goal}</span>
          </div>
          <div class="k-m"><a class="btn primary" href="${x.url}" target="_blank" download>T·∫£i PDF</a></div>`;
          wrap.appendChild(d);
        });
      }
    }

    function renderVideos(){
      const wrap=$("#videoList"); wrap.innerHTML="";
      VIDEO_GALLERY.forEach(v=>{
        const c=document.createElement("div"); c.className="card pad lift reveal";
        c.innerHTML = `
          <iframe title="${v.title}" class="thumb" src="${v.src}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
          <div class="k-m"><b>${v.title}</b></div>`;
        wrap.appendChild(c);
      });
    }

    function renderDealer(){
      const box=$("#dealerBox");
      const state = { logged:false, email: "" };
      draw();
      function draw(){
        box.innerHTML="";
        if(!state.logged){
          const f=document.createElement("form"); f.className="card pad lift"; f.innerHTML = `
            <b>ƒêƒÉng nh·∫≠p C·ªïng th√¥ng tin</b>
            <label class="k-m"><span>Email</span><input type="email" id="dlEmail" required placeholder="dai_ly@email.com" /></label>
            <label class="k-m"><span>M√£ truy c·∫≠p</span><input type="password" id="dlCode" required value="KINGBULL2025" /></label>
            <div id="dlMsg" class="hint k-m" role="status"></div>
            <div class="k-m"><button class="btn primary" type="submit">ƒêƒÉng nh·∫≠p</button></div>`;
          f.addEventListener("submit",e=>{
            e.preventDefault();
            const email = $("#dlEmail").value;
            const ok = $("#dlCode").value.trim().toUpperCase()==="KINGBULL2025" && email.includes("@");
            if(ok){ state.logged=true; state.email = email; draw(); } else { $("#dlMsg").textContent="M√£ truy c·∫≠p ho·∫∑c email kh√¥ng h·ª£p l·ªá."; }
          });
          box.appendChild(f);
        } else {
          const g=document.createElement("div"); g.className="lift";
          g.innerHTML = `
            <div style="margin-bottom:16px">
              <b>Ch√†o m·ª´ng, ${state.email}!</b>
              <div class="hint">ƒê√¢y l√† khu v·ª±c t√†i li·ªáu v√† video hu·∫•n luy·ªán n·ªôi b·ªô.</div>
            </div>
            <div class="row col-2">
              <div class="card pad">
                <b>T√†i li·ªáu kinh doanh</b>
                <ul class="k-m hint" style="line-height:1.9; list-style:none; padding:0; display:grid; gap:8px">
                  <li><a class="btn ghost" style="width:100%; justify-content:flex-start" href="#" target="_blank">B·∫£ng gi√° s·ªë l∆∞·ª£ng l·ªõn (PDF)</a></li>
                  <li><a class="btn ghost" style="width:100%; justify-content:flex-start" href="#" target="_blank">Ch√≠nh s√°ch chi·∫øt kh·∫•u (PDF)</a></li>
                  <li><a class="btn ghost" style="width:100%; justify-content:flex-start" href="#" target="_blank">T√†i li·ªáu hu·∫•n luy·ªán k·ªπ thu·∫≠t (PDF)</a></li>
                </ul>
              </div>
              <div class="card pad">
                <b>Video Training</b>
                <ul class="k-m hint" style="line-height:1.9; list-style:none; padding:0; display:grid; gap:8px">
                  <li><a class="btn ghost" style="width:100%; justify-content:flex-start" href="https://www.youtube.com/watch?v=aqz-KE-bpKQ" target="_blank">Ph·ªëi tr·ªôn & ki·ªÉm so√°t ch·∫•t l∆∞·ª£ng</a></li>
                  <li><a class="btn ghost" style="width:100%; justify-content:flex-start" href="https://www.youtube.com/watch?v=oUFJJNQGwhk" target="_blank">V·∫≠n h√†nh kho l·∫°nh & an to√†n</a></li>
                </ul>
              </div>
            </div>`;
          box.appendChild(g);
        }
      }
    }

    /* Map */
    let mapInstance=null, layerGroup=null;
    function initMapOnce(){
      if(mapInstance) return;
      mapInstance = L.map('leafletMap').setView([14.0583,108.2772], 5.5); // View of Vietnam
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'&copy; OpenStreetMap'}).addTo(mapInstance);
      layerGroup = L.layerGroup().addTo(mapInstance);
      drawMap();
      $("#regionFilter").addEventListener("change", drawMap);
    }
    function drawMap(){
      const region = $("#regionFilter").value || "T·∫•t c·∫£";
      layerGroup.clearLayers();
      WAREHOUSES.filter(w => region==="T·∫•t c·∫£" || w.region===region).forEach(w=>{
        const mk = L.marker([w.lat,w.lng]).addTo(layerGroup); mk.bindPopup(`<b>${w.name}</b><br/>Khu v·ª±c: ${w.region}`);
      });
      DESTINATIONS.filter(d => region==="T·∫•t c·∫£" || d.region===region).forEach(d=>{
        const mk = L.circleMarker([d.lat,d.lng],{radius:8,color:"var(--kb-blue)",fillColor:"var(--kb-blue)",fillOpacity:0.7}).addTo(layerGroup); mk.bindPopup(`<b>${d.name}</b><br/>Khu v·ª±c: ${d.region}`);
      });
    }

    /* Support */
    $("#supportForm").addEventListener("submit", e=>{
      e.preventDefault();
      $("#supportMsg").textContent = `C·∫£m ∆°n ${$("#spName").value}! ƒê√£ nh·∫≠n y√™u c·∫ßu, k·ªπ thu·∫≠t vi√™n s·∫Ω li√™n h·ªá b·∫°n s·ªõm.`;
      $("#supportForm").reset();
    });

    /* Logistics */
    function renderLogistics(){
      const destSel = $("#destSelect"); DESTINATIONS.forEach(d=>destSel.append(new Option(d.name,d.id)));
      $("#logiForm").addEventListener("submit", e=>{
        e.preventDefault();
        const qty = Math.max(1, Number($("#qtyTon").value||0));
        const dest = DESTINATIONS.find(d=>d.id===destSel.value);
        let best=null, bestD=Infinity;
        WAREHOUSES.forEach(w=>{ const d=distanceKm({lat:w.lat,lng:w.lng},{lat:dest.lat,lng:dest.lng}); if(d<bestD){bestD=d; best=w;} });
        const capacityPerContainerTon = 25;
        const trips = ceil(qty / capacityPerContainerTon);
        const hours = bestD/45 + 2; // Avg speed 45km/h + 2h loading/unloading
        const etaDays = Math.max(1, Math.round(hours/8));
        const R=$("#logiResult"); R.style.display="grid"; R.innerHTML="";
        [
          {label:"Kho xu·∫•t ph√°t", value:best.name},
          {label:"Kho·∫£ng c√°ch (km)", value:Math.round(bestD)},
          {label:"S·ªë chuy·∫øn (cont 25T)", value:trips},
          {label:"Th·ªùi gian giao (ng√†y)", value:etaDays},
        ].forEach(s=>{
          const c=document.createElement("div"); c.className="card pad lift";
          c.innerHTML=`<small class="hint">${s.label}</small><div><b>${s.value}</b></div>`;
          R.appendChild(c);
        });
      });
    }

    /* News */
    function renderNews(){
      const tags = ["T·∫•t c·∫£", ...new Set(NEWS.map(n=>n.tag))];
      const nf = $("#newsFilter"); tags.forEach(t=>nf.append(new Option(t,t)));
      nf.addEventListener("change", draw); draw();
      function draw(){
        const f = nf.value || "T·∫•t c·∫£";
        const data = NEWS.filter(n=> f==="T·∫•t c·∫£" || n.tag===f);
        const wrap=$("#newsList"); wrap.innerHTML="";
        data.forEach(n=>{
          const c=document.createElement("div"); c.className="card pad lift reveal";
          c.innerHTML=`<div style="display:flex;justify-content:space-between;align-items:center">
            <span class="pill">${n.tag}</span><span class="hint">${n.date}</span></div>
            <div class="k-m"><b>${n.title}</b></div>
            <div class="hint">${n.excerpt}</div>`;
          wrap.appendChild(c);
        });
      }
    }

    /* R&D */
    $("#rdForm").addEventListener("submit", e=>{
      e.preventDefault();
      $("#rdMsg").textContent = "ƒê√£ nh·∫≠n th√¥ng tin! Ch√∫ng t√¥i s·∫Ω ph·∫£n h·ªìi qua email trong v√≤ng 3-5 ng√†y l√†m vi·ªác.";
      $("#rdForm").reset();
    });

    /* Boot */
    function init(){
      setupActiveNav();
      setupScrollFX();
      setupReveal();

      renderCaseStudies();
      renderPDF();
      renderVideos();
      renderDealer();
      renderLogistics();
      renderNews();

      const mapSection = $("#supply");
      const io = new IntersectionObserver((entries)=>{
        if(entries.some(e=>e.isIntersecting)){ initMapOnce(); io.disconnect(); }
      }, {rootMargin:"0px 0px 100px 0px"});
      io.observe(mapSection);

      $("#year").textContent = new Date().getFullYear();
      if(location.hash){ const el = $(location.hash); if(el) el.scrollIntoView(); }
    }
    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
